<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Dino Run - Monster Emoji</title>
<style>
  body {
    margin: 0;
    background: #fefefe;
    font-family: sans-serif;
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  #scoreboard {
    font-size: 24px;
    margin: 10px;
  }
  #game {
    position: relative;
    width: 1000px;
    height: 300px;
    background: #fff;
    border: 4px solid #333;
    overflow: hidden;
    border-radius: 12px;
  }
  #ground {
    position: absolute;
    bottom: 0;
    height: 50px;
    width: 200%;
    background: repeating-linear-gradient(
      to right,
      #999 0px,
      #999 10px,
      #777 10px,
      #777 20px
    );
    animation: groundMove linear infinite;
    animation-duration: 1.5s;
    z-index: 1;
  }
  @keyframes groundMove {
    0% { transform: translateX(0); }
    100% { transform: translateX(-50%); }
  }
  .entity {
    position: absolute;
    bottom: 50px;
    font-size: 60px;
    transform: scaleX(-1); /* hadap kanan */
    z-index: 2;
  }
  #dino {
    left: 150px;
  }
  #monster {
    left: -200px;
    font-size: 180px;
    opacity: 0.8;
    z-index: 0;
  }
  .obstacle {
    position: absolute;
    bottom: 50px;
    font-size: 60px;
    z-index: 3;
  }
  #info {
    margin: 8px;
    color: #444;
  }
</style>
</head>
<body>

<div id="scoreboard">Score: 0 | High Score: 0</div>
<div id="game">
  <div id="monster" class="entity">ðŸ‘¹</div>
  <div id="dino" class="entity">ðŸ¦•</div>
  <div id="ground"></div>
</div>
<div id="info">Press Space to Jump | Shift to Sprint | Enter to Restart</div>

<script>
  const dino = document.getElementById('dino');
  const monster = document.getElementById('monster');
  const ground = document.getElementById('ground');
  const scoreboard = document.getElementById('scoreboard');
  const game = document.getElementById('game');

  let isJumping = false;
  let dinoBottom = 50;
  let velocity = 0;
  const gravity = 0.7;
  const jumpVelocity = 14;
  let groundSpeed = 6;
  let sprinting = false;

  let obstacles = [];
  let obstacleTimer = 0;

  let monsterLeft = -180; // start jauh
  let score = 0;
  let highScore = 0;
  let gameOver = false;

  if(localStorage.getItem('dinoEmojiScore')) {
    highScore = parseInt(localStorage.getItem('dinoEmojiScore'));
  }

  function updateScoreboard() {
    scoreboard.textContent = `Score: ${score} | High Score: ${highScore}`;
  }

  function createObstacle() {
    const obs = document.createElement('div');
    obs.classList.add('obstacle');
    obs.textContent = 'ðŸŒµ';
    let startX = game.clientWidth + 100 + Math.random() * 300;
    obs.style.left = startX + 'px';
    game.appendChild(obs);
    obstacles.push({ el: obs, pos: startX });
  }

  function resetGame() {
    obstacles.forEach(o => o.el.remove());
    obstacles = [];
    score = 0;
    gameOver = false;
    dinoBottom = 50;
    velocity = 0;
    isJumping = false;
    monsterLeft = -180;
    dino.style.bottom = dinoBottom + 'px';
    monster.style.left = monsterLeft + 'px';
    ground.style.animationDuration = '1.5s';
    groundSpeed = 6;
    updateScoreboard();
  }

  function gameLoop() {
    if (gameOver) return;

    // Jumping
    if (isJumping) {
      velocity -= gravity;
      dinoBottom += velocity;
      if (dinoBottom <= 50) {
        dinoBottom = 50;
        isJumping = false;
      }
      dino.style.bottom = dinoBottom + 'px';
    }

    // Move obstacles
    obstacles.forEach((obs, idx) => {
      obs.pos -= groundSpeed;
      obs.el.style.left = obs.pos + 'px';

      if (
        obs.pos < 180 && obs.pos > 140 &&
        dinoBottom <= 90
      ) {
        gameOver = true;
        if (score > highScore) {
          highScore = score;
          localStorage.setItem('dinoEmojiScore', highScore);
        }
        scoreboard.textContent = `Game Over! Final: ${score} | High Score: ${highScore}`;
      }

      if (obs.pos < -60) {
        obs.el.remove();
        obstacles.splice(idx, 1);
        score++;
        updateScoreboard();
      }
    });

    // Monster mendekat perlahan
    if (monsterLeft < 120) {
      let speed = Math.min(0.3 + score * 0.01, 0.9); // lebih lambat dari versi sebelumnya
      monsterLeft += speed;
      monster.style.left = monsterLeft + 'px';
    }

    // Cek kalau monster sudah nyusul
    if (monsterLeft + 120 > 150) {
      gameOver = true;
      if (score > highScore) {
        highScore = score;
        localStorage.setItem('dinoEmojiScore', highScore);
      }
      scoreboard.textContent = `Game Over! Tertangkap monster! Final: ${score} | High Score: ${highScore}`;
    }

    // Buat obstacle baru
    obstacleTimer -= groundSpeed;
    if (obstacleTimer <= 0) {
      createObstacle();
      obstacleTimer = 250 + Math.random() * 300;
    }

    requestAnimationFrame(gameLoop);
  }

  document.addEventListener('keydown', e => {
    if (e.code === 'Space' && !gameOver) {
      if (!isJumping) {
        isJumping = true;
        velocity = jumpVelocity;
      }
    }
    if (e.code === 'ShiftLeft') {
      sprinting = true;
      groundSpeed = 10;
      ground.style.animationDuration = '0.8s';
    }
    if (e.code === 'Enter' && gameOver) {
      resetGame();
      gameLoop();
    }
  });

  document.addEventListener('keyup', e => {
    if (e.code === 'ShiftLeft') {
      sprinting = false;
      groundSpeed = 6;
      ground.style.animationDuration = '1.5s';
    }
  });

  resetGame();
  gameLoop();
</script>

</body>
</html>
